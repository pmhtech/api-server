<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="SysSequence">

	<insert id="insert" parameterType="sysSequence">
	/*	SysSequence.insert	*/
	
		<selectKey keyProperty="SEQ" resultType="int">
		INSERT INTO SYS_SEQUENCE(
			COMPANY
			,YEAR
			,SEQ
			,TABLE_NAME
			,CREATER
			,CREATE_DT
			,CREATE_IP
		)
		SELECT	#{COMPANY}
				,'16'
				,	SELECT	IFNULL(MAX(SEQ),0)+1
					FROM	SYS_SEQUENCE
					WHERE	COMPANY		= #{COMPANY}
					AND		TABLE_NAME	= #{TABLE_NAME}
				,#{TABLE_NAME}
				,#{CREATER}
				,#{CREATE_DT}
				,#{CREATE_IP}
		FROM	DUAL	
		  SELECT SCOPE_IDENTITY()
		</selectKey>	
	</insert>

	<select id="selectMaxSequence" parameterType="paramMap" resultType="string">
	/*	SysSequence.selectMaxSequence	*/
		CONCAT(A.REF1,'_',LPAD(IFNULL(MAX(B.SEQUENCE),0)+1,6,'0')) AS TABLE_PK
	</select>
</mapper> 
